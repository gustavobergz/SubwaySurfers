// saves/save-injector.js
(function () {
  const KEY_PATH = "/idbfs/5bc32e1a17c4bdfdd5da57ab99ff0a2c/Save/cloud";
  const DB_NAME = "/idbfs";
  const STORE_NAME = "FILE_DATA";

  const FALLBACK_CONTENTS_B64 = `
FAAAANovM9/T6yTL6ARtHrfZgdHiDFVZ9C0AAPQtAAAQb2JmdXNjYXRlZENvaW5zAFGyfzsQb2Jm
dXNjYXRlZEtleXMA8KN9ABBvYmZ1c2NhdGVkVW5yZXdhcmRlZENvaW5zAAIAAAADcG93ZXJ1cHMA
OgAAABBob3ZlcmJvYXJkAAAAAAAQaGVhZHN0YXJ0MjAwMAD3xJo7EHNjb3JlYm9vc3RlcgAUAAAA
AAN1cGdyYWRlcwBLAAAAEGpldHBhY2sAAAAAABBzdXBlcnNuZWFrZXJzAAAAAAAQY29pbm1hZ25l
dAAAAAAAEGRvdWJsZU11bHRpcGxpZXIAAAAAAAAEcGVuZGluZ1Jld2FyZHMABQAAAAADYm9hcmRU
aGVtZURhdGEABQAAAAAEdW5sb2NrZWRDaGFyYWN0ZXJzAIYAAAACMAAGAAAAc2xpY2sAAjEABwAA
AGZyaXp6eQACMgAIAAAAcHJpbmNlawACMwAGAAAAYnJvZHkAAjQABAAAAHpvZQACNQAGAAAAbmlu
amEAAjYABAAAAHRhZwACNwAHAAAAdHJpY2t5AAI4AAUAAABsdWN5AAI5AAYAAABmcmVzaAAAA2Nv
bGxlY3RlZENoYXJhY3RlclRva2VucwAzAAAAEHRyaWNreQACAAAAEGZyZXNoABQJAAAQeXV0YW5p
AAIAAAAQc3Bpa2UADAAAAAADc2VsZWN0ZWRPdXRmaXRzAEUAAAAQcHJpbmNlawACAAAAEHpvZQAC
AAAAEHRhZwABAAAAEHRyaWNreQABAAAAEGx1Y3kAAQAAABBmcmVzaAABAAAAAAN1bmxvY2tlZE91
dGZpdHMAogAAAARzbGljawAMAAAAEDAAAQAAAAAEcHJpbmNlawAMAAAAEDAAAgAAAAAEem9lAAwA
AAAQMAACAAAAAAR0YWcADAAAABAwAAEAAAAABGZyZXNoAAwAAAAQMAABAAAAAAR0cmlja3kAEwAA
ABAwAAIAAAAQMQABAAAAAARsdWN5AAwAAAAQMAABAAAAAARicm9keQAMAAAAEDAAAQAAAAAABHVu
bG9ja2VkQm9hcmRzABYAAAACMAAKAAAAc3RhcmJvYXJkAAAEaGFzU2tpcHBlZE1pc3Npb25zABEA
AAAIMAAACDEAAAgyAAAAEHJ1bnNDb21wbGV0ZWRJbkN1cnJlbnRNaXNzaW9uU2V0AG8BAAAQY3Vy
cmVudE1pc3Npb25TZXQAAQAAAARjdXJyZW50TWlzc2lvblByb2dyZXNzABoAAAAQMAAAAAAAEDEA
FAAAABAyAAIAAAAAEG1pc3Npb25TZXRDb21wbGV0ZWRDb3VudAACAAAAEGN1cnJlbnRTa2lwRm9y
VmlkZW9NaXNzaW9uSW5kZXgAAAAAAAljdXJyZW50U2tpcEZvclZpZGVvSW5kZXhTZXRBdABWOzBg
kwEAAAlsYXN0VGltZU1pc3Npb25XYXNTa2lwcGVkRm9yVmlkZW8AgPN37nzH//8IaGFzU2tpcHBl
ZE1pc3Npb25Gb3JWaWRlb1RoaXNTZXQAAARhY2hpZXZlbWVudFByb2dyZXNzAAUAAAAAEHVucmVw
b3J0ZWRHYW1lcwAAAAAACXVucmVwb3J0ZWRHYW1lc1RpbWVTdGFtcACA83fufMf//xBoaWdoU2Nv
cmUAwWmCAAR1bmxvY2tlZFRyb3BoaWVzACUAAAAIMAAACDEAAAgyAAAIMwAACDQAAAg1AAAINgAA
CDcAAAADYXdhcmRzUHJvZ3Jlc3MAnw8AAANTQ09SRV9QT0lOVFNfU0lOR0xFX0xBTkUA7gAAAAJh
Y3RpdmVUaWVyVHlwZQAIAAAARGlhbW9uZAACcHJvZ3Jlc3NUaWVyVHlwZQAIAAAARGlhbW9uZAAC
Y3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACQAAAEZpbmlzaGVkAAJjdXJyZW50UHJvZ3Jlc3NBd2Fy
ZFN0YXRlAAkAAABGaW5pc2hlZAAJbGFzdEFjdGl2ZVN0YXRlQ2hhbmdlRGF0ZVRpbWUA7bpcNZIB
AAAQb2Zmc2V0AP////8Dc3RhdE9mZnNldAAFAAAAAAhoYXNNaWdyYXRlZFRvVXNlU3RhdE9mZnNl
dAAAAANPUEVOX1hfU1VQRVJfTVlTVEVSWV9CT1hFUwANAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABC
cm9uemUAAnByb2dyZXNzVGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3Rh
dGUACwAAAEluUHJvZ3Jlc3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jl
c3MACWxhc3RBY3RpdmVTdGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0
YXRPZmZzZXQAIgAAABBTdXBlck15c3RlcnlCb3hlc09wZW5lZAAAAAAAAAhoYXNNaWdyYXRlZFRv
VXNlU3RhdE9mZnNldAABAANXSU5fWF9KQUNLUE9UUwABAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABC
cm9uemUAAnByb2dyZXNzVGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3Rh
dGUACwAAAEluUHJvZ3Jlc3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jl
c3MACWxhc3RBY3RpdmVTdGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0
YXRPZmZzZXQAFgAAABBKYWNrcG90c1dvbgAAAAAAAAhoYXNNaWdyYXRlZFRvVXNlU3RhdE9mZnNl
dAABAANTQ09SRV9QT0lOVFNfU0lOR0xFX1JVTl9OT19KVU1QX09SX1JPTEwA7gAAAAJhY3RpdmVU
aWVyVHlwZQAIAAAARGlhbW9uZAACcHJvZ3Jlc3NUaWVyVHlwZQAIAAAARGlhbW9uZAACY3VycmVu
dEFjdGl2ZUF3YXJkU3RhdGUACQAAAEZpbmlzaGVkAAJjdXJyZW50UHJvZ3Jlc3NBd2FyZFN0YXRl
AAkAAABGaW5pc2hlZAAJbGFzdEFjdGl2ZVN0YXRlQ2hhbmdlRGF0ZVRpbWUAFtxcNZIBAAAQb2Zm
c2V0AP////8Dc3RhdE9mZnNldAAFAAAAAAhoYXNNaWdyYXRlZFRvVXNlU3RhdE9mZnNldAAAAANP
UEVOX1hfTVlTVEVSWV9CT1hFUwAJAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dy
ZXNzVGllclR5cGUABwAAAFNpbHZlcgACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUADAAAAENvbGxl
Y3RpYmxlAAJjdXJyZW50UHJvZ3Jlc3NBd2FyZFN0YXRlAAsAAABJblByb2dyZXNzAAlsYXN0QWN0
aXZlU3RhdGVDaGFuZ2VEYXRlVGltZQDarRRjkgEAABBvZmZzZXQA/////wNzdGF0T2Zmc2V0AB0A
AAAQTXlzdGVyeUJveGVzT3BlbmVkABQAAAAACGhhc01pZ3JhdGVkVG9Vc2VTdGF0T2Zmc2V0AAEA
A1BJQ0tfWF9LRVlTX0lOR0FNRQADAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dy
ZXNzVGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJv
Z3Jlc3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3Rp
dmVTdGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0YXRPZmZzZXQAGAAA
ABBLZXlzQ29sbGVjdGVkAAAAAAAACGhhc01pZ3JhdGVkVG9Vc2VTdGF0T2Zmc2V0AAEAA0NPTExF
Q1RfQ09JTlNfU0lOR0xFX1JVTgDwAAAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dy
ZXNzVGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJv
Z3Jlc3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3Rp
dmVTdGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0YXRPZmZzZXQABQAA
AAAIaGFzTWlncmF0ZWRUb1VzZVN0YXRPZmZzZXQAAAADSEFWRV9TVVBFUlNOSUNLRVJTX0FDVElW
RV9YX01JTl9JTl9BX1JPVwDwAAAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dyZXNz
VGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJvZ3Jl
c3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3RpdmVT
dGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0YXRPZmZzZXQABQAAAAAI
aGFzTWlncmF0ZWRUb1VzZVN0YXRPZmZzZXQAAAADQ09NUExFVEVfTUlTU0lPTlNfU0lOR0xFX1JV
TgDwAAAAAmFjdGl2ZVRpZXJUeXBlAAcAAABTaWx2ZXIAAnByb2dyZXNzVGllclR5cGUABwAAAFNp
bHZlcgACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MAAmN1cnJlbnRQcm9n
cmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3RpdmVTdGF0ZUNoYW5nZURhdGVU
aW1lAIIkQzCSAQAAEG9mZnNldAD/////A3N0YXRPZmZzZXQABQAAAAAIaGFzTWlncmF0ZWRUb1Vz
ZVN0YXRPZmZzZXQAAAADU0NPUkVfUE9JTlRTX1NJTkdMRV9SVU5fTk9fQ09JTlMA7gAAAAJhY3Rp
dmVUaWVyVHlwZQAIAAAARGlhbW9uZAACcHJvZ3Jlc3NUaWVyVHlwZQAIAAAARGlhbW9uZAACY3Vy
cmVudEFjdGl2ZUF3YXJkU3RhdGUACQAAAEZpbmlzaGVkAAJjdXJyZW50UHJvZ3Jlc3NBd2FyZFN0
YXRlAAkAAABGaW5pc2hlZAAJbGFzdEFjdGl2ZVN0YXRlQ2hhbmdlRGF0ZVRpbWUA+w1dNZIBAAAQ
b2Zmc2V0AP////8Dc3RhdE9mZnNldAAFAAAAAAhoYXNNaWdyYXRlZFRvVXNlU3RhdE9mZnNldAAA
AANQSUNLVVBfUE9XRVJVUFMABAEAAAJhY3RpdmVUaWVyVHlwZQAHAAAAQnJvbnplAAJwcm9ncmVz
c1RpZXJUeXBlAAcAAABTaWx2ZXIAAmN1cnJlbnRBY3RpdmVBd2FyZFN0YXRlAAwAAABDb2xsZWN0
aWJsZQACY3VycmVudFByb2dyZXNzQXdhcmRTdGF0ZQALAAAASW5Qcm9ncmVzcwAJbGFzdEFjdGl2
ZVN0YXRlQ2hhbmdlRGF0ZVRpbWUAaKodY5IBAAAQb2Zmc2V0AP////8Dc3RhdE9mZnNldAAYAAAA
EFBpY2t1cFBvd2VydXAAZAAAAAAIaGFzTWlncmF0ZWRUb1VzZVN0YXRPZmZzZXQAAQADQ09NUExF
VEVfWF9NSVNTSU9OUwAGAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dyZXNzVGll
clR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MA
AmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3RpdmVTdGF0
ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0YXRPZmZzZXQAGwAAABBNaXNz
aW9uQ29tcGxldGVkAAAAAAAACGhhc01pZ3JhdGVkVG9Vc2VTdGF0T2Zmc2V0AAEAA0NPTExFQ1Rf
T0xEX1RST1BIWV9JVEVNU19NQgAwAQAAAmFjdGl2ZVRpZXJUeXBlAAcAAABCcm9uemUAAnByb2dy
ZXNzVGllclR5cGUABwAAAEJyb256ZQACY3VycmVudEFjdGl2ZUF3YXJkU3RhdGUACwAAAEluUHJv
Z3Jlc3MAAmN1cnJlbnRQcm9ncmVzc0F3YXJkU3RhdGUACwAAAEluUHJvZ3Jlc3MACWxhc3RBY3Rp
dmVTdGF0ZUNoYW5nZURhdGVUaW1lAIDzd+58x///EG9mZnNldAD/////A3N0YXRPZmZzZXQARQAA
ABBHb2xkQ2hhaW5DbG9jawAAAAAAEEhlYWRwaG9uZXMAAAAAABBUYXBlQmxhY2sAAAAAABBMcEJs
YWNrAAAAAAAACGhhc01pZ3JhdGVkVG9Vc2VTdGF0T2Zmc2V0AAEAA0NPTExFQ1RfT0xEX1RST1BI
WV9JVEVNU19TTUIALgEAAAJhY3RpdmVUaWVyVHlwZQAHAAAAQnJvbnplAAJwcm9ncmVzc1RpZXJU
eXBlAAcAAABCcm9uemUAAmN1cnJlbnRBY3RpdmVBd2FyZFN0YXRlAAsAAABJblByb2dyZXNzAAJj
dXJyZW50UHJvZ3Jlc3NBd2FyZFN0YXRlAAsAAABJblByb2dyZXNzAAlsYXN0QWN0aXZlU3RhdGVD
aGFuZ2VEYXRlVGltZQCA83fufMf//xBvZmZzZXQA/////wNzdGF0T2Zmc2V0AEMAAAAQR29sZENo
YWluRG9sbGFyAAAAAAAQR29sZFNrdWxsAAAAAAAQR29sZGJhcgAAAAAAEERpYW1vbmQAAAAAAAAI
aGFzTWlncmF0ZWRUb1VzZVN0YXRPZmZzZXQAAQAACXdlZWtseUdpZnRVbmxvY2tUaW1lAIDzd+58
x///BHN0YXRWYWx1ZXMAIwEAABAwAAAAAAAQMQAAAAAAEDIAAAAAABAzAAAAAAAQNAAAAAAAEDUA
AAAAABA2AAAAAAAQNwAAAAAAEDgAAQAAABA5AAAAAAAQMTAAAAAAABAxMQAAAAAAEDEyAAAAAAAQ
MTMABQAAABAxNAAAAAAAEDE1AAAAAAAQMTYAAAAAABAxNwAAAAAAEDE4AAAAAAAQMTkAAAAAABAy
MAAAAAAAEDIxAAAAAAAQMjIAAAAAABAyMwAAAAAAEDI0AAAAAAAQMjUAwAEAABAyNgAAAAAAEDI3
AAAAAAAQMjgAAAAAABAyOQA6AAAAEDMwAAAAAAAQMzEAAAAAABAzMgAAAAAAEDMzAAAAAAAQMzQA
AAAAABAzNQAAAAAAEDM2AAAAAAAABG15c3RlcnlCb3hlc09wZW5lZAAaAAAAEDAAOQAAABAxAAAA
AAAQMgAAAAAAABBjb21wbGV0ZWRSdW5Db3VudADHAQAAAmN1cnJlbnRDaGFyYWN0ZXJJZAAIAAAA
cHJpbmNlawACY3VycmVudEJvYXJkSWQABwAAAG5vcm1hbAACcHJldmlvdXNCb2FyZElkAAcAAABu
b3JtYWwAA2F3YXJkSXNOZXcAkQEAAAhDT0xMRUNUX09MRF9UUk9QSFlfSVRFTVNfTUIAAAhDT0xM
RUNUX09MRF9UUk9QSFlfSVRFTVNfU01CAAAIQ09NUExFVEVfWF9NSVNTSU9OUwAACFBJQ0tVUF9Q
T1dFUlVQUwAACFNDT1JFX1BPSU5UU19TSU5HTEVfUlVOX05PX0NPSU5TAAAIQ09NUExFVEVfTUlT
U0lPTlNfU0lOR0xFX1JVTgAACEhBVkVfU1VQRVJTTklDS0VSU19BQ1RJVkVfWF9NSU5fSU5fQV9S
T1cAAAhDT0xMRUNUX0NPSU5TX1NJTkdMRV9SVU4AAAhQSUNLX1hfS0VZU19JTkdBTUUAAAhPUEVO
X1hfTVlTVEVSWV9CT1hFUwAACFNDT1JFX1BPSU5UU19TSU5HTEVfUlVOX05PX0pVTVBfT1JfUk9M
TAAACFdJTl9YX0pBQ0tQT1RTAAAIT1BFTl9YX1NVUEVSX01ZU1RFUllfQk9YRVMAAAhTQ09SRV9Q
T0lOVFNfU0lOR0xFX0xBTkUAAAADYXdhcmRIYXNQYXllZE91dACRAQAACENPTExFQ1RfT0xEX1RS
T1BIWV9JVEVNU19NQgAACENPTExFQ1RfT0xEX1RST1BIWV9JVEVNU19TTUIAAAhDT01QTEVURV9Y
X01JU1NJT05TAAAIUElDS1VQX1BPV0VSVVBTAAAIU0NPUkVfUE9JTlRTX1NJTkdMRV9SVU5fTk9f
Q09JTlMAAQhDT01QTEVURV9NSVNTSU9OU19TSU5HTEVfUlVOAAEISEFWRV9TVVBFUlNOSUNLRVJT
X0FDVElWRV9YX01JTl9JTl9BX1JPVwAACENPTExFQ1RfQ09JTlNfU0lOR0xFX1JVTgAACFBJQ0tf
WF9LRVlTX0lOR0FNRQAACE9QRU5fWF9NWVNURVJZX0JPWEVTAAAIU0NPUkVfUE9JTlRTX1NJTkdM
RV9SVU5fTk9fSlVNUF9PUl9ST0xMAAEIV0lOX1hfSkFDS1BPVFMAAAhPUEVOX1hfU1VQRVJfTVlT
VEVSWV9CT1hFUwAACFNDT1JFX1BPSU5UU19TSU5HTEVfTEFORQABAAhhd2FyZHNGaXJzdExvYWRl
ZAABAndlZWtseUh1bnRQcm9ncmVzc1ZlcnNpb24ABAAAADEuMAAEaGFzTG9nZ2VkV2Vla2x5SHVu
dFBlcmlvZAAVAAAACDAAAQgxAAEIMgABCDMAAQADd2Vla2x5SHVudFByb2dyZXNzRGF0YQBfAAAA
Amh1bnRTdGFydFZlcnNpb24AFAAAADA5LzEzLzIwMTggMDA6MDA6MDAABHRva2VuUHJvZ3Jlc3MA
IQAAABAwAAAAAAAQMQAAAAAAEDIAAAAAABAzAAAAAAAAABB3b3JkSHVudFdvcmRzSW5Sb3cAAQAA
AAh3b3JkSHVudFBheWVkT3V0AAAQd29yZEh1bnRVbmxvY2tlZE1hc2sAAQAAABB3b3JkSHVudExh
c3RQYXlvdXREYXlPZlllYXIAGwEAAANjaGFyYWN0ZXJOYW1lRXZlbnREYXRhAN0AAAACY3VycmVu
dENoYXJhY3RlcgAGAAAAc2xpY2sAEGNvbGxlY3RlZExldHRlckluZGV4AP////8Qc2tpcHBlZENo
YXJhY3RlcnMAAAAAAAh3YXNMYXN0Q2hhcmFjdGVyQ29tcGxldGVkAAAQY29tcGxldGVkQ2hhcmFj
dGVycwAAAAAABGNoYXJhY3RlcnNMaXN0AAUAAAAABGNhdGVnb3J5V29yZHNMaXN0AAUAAAAAEmV2
ZW50SUQAAAAAAAAAAAACZXZlbnRDYXRlZ29yeQAFAAAAQ2F0MQAAEmxhc3RFdmVudElEAAAAAAAA
AAAAEmxhc3RUaW1lQW5FdmVudEhhc0JlZW5UcmllZAAAAAAAAAAAABJsYXN0VGltZUFuRXZlbnRX
YXNTdGFydGVkANVv72YAAAAAEmxhc3RUaW1lRXZlbnRQb3B1cFdhc0ZvcmNlU2hvd24AAAAAAAAA
AAACbGFzdEV2ZW50SXRlbUlEAAEAAAAACHNob3VsZFJlc3RvcmVJdGVtQWZ0ZXJFdmVudAAAAndv
cmRIdW50RGFpbHlXb3JkAAUAAABEQVNIAAl3b3JkSHVudEV4cGlyZVRpbWUARSyeYJMBAAACc3li
b0FuYWx5dGljc1NhbXBsZVN0YXRlAAoAAABVbnNhbXBsZWQAAnN5Ym9BbmFseXRpY3NVc2VySWQA
AQAAAAACc3lib0FnZ3JlZ2F0ZWREYXRhU3RyaW5nAAEAAAAAA3N5Ym9BbmFseXRpY3NVbmhhbmRs
ZWRBYlRlc3REYXRhAAUAAAAAEHN5Ym9BbmFseXRpY3NDdXJyZW50U2Vzc2lvbgD/////CGtpbG9v
QW5hbHl0aWNzSGFzTG9nZ2VkU3lib1VzZXJJZAAAEHBlcnNpc3RlZFNlc3Npb25FdmVudE51bWJl
cgD/////A21hbmFnZXJEYXRhAKUAAAAJbGFzdFN1Ym1pdHRlZFNjb3JlU3RhcnRUaW1lAIDzd+58
x///CWxhc3RTdWJtaXR0ZWRTY29yZUVuZFRpbWUAgPN37nzH//8KbmV4dFRvdXJuYW1lbnRUaW1l
ABB1bnN1Ym1pdHRlZFNjb3JlTm9Ub3VybmFtZW50AAAAAAAKdW5zdWJtaXR0ZWRTY29yZU5vVG91
cm5hbWVudFRpbWUAAAJsYXN0VG9wUnVuUmVzdWx0QXdhcmRlZElEAAEAAAAAAnBlbmRpbmdUb3BS
dW5SZXN1bHRJRAABAAAAABBwZW5kaW5nVG9wUnVuUmVzdWx0c1Njb3JlAP////8QcGVuZGluZ1Rv
cFJ1blJlc3VsdHNSYW5rAP////8QcGVuZGluZ1RvcFJ1blJlc3VsdHNXZWVrAP////8QcGVuZGlu
Z1RvcFJ1bkJlYXRlbkZyaWVuZHNBd2FyZAAAAAAACGJlaGF2aW9yYWxBZHNBbGxvd2VkAAEDaW50
ZXJzdGl0aWFsU3RhdHMAnwAAAANsaXN0VmVyc2lvbkZvcklEACkAAAACaG9tZV9pbnRlcnN0aXRp
YWxzX2xpc3QABwAAAG5vdHNldAAAEHNlZW5UaGlzSG91cgABAAAAEGN1cnJlbnRIb3VyADu1DgEQ
c2VlblRoaXNEYXkAAQAAABBjdXJyZW50RGF5AI1HCwAIaGFzU2VlbkZpcnN0SW50ZXJzdGl0aWFs
AAAAA2NvbnN1bWFibGVTZWVuVmlkZW9zQ291bnQABQAAAAADY29uc3VtYWJsZVZpZGVvU2VlbkF0
AAUAAAAAA2Nvb2xkb3ducwAbAAAAA2FjdGl2ZUNvb2xkb3ducwAFAAAAAAAQaW5BcHBMZWdhY3lQ
dXJjaGFzZUNvdW50AAAAAAAQaW5BcHBDb25zdW1hYmxlUHVyY2hhc2VDb3VudAAAAAAAEGluQXBw
UmVzdG9yZWRQdXJjaGFzZUNvdW50AAAAAAAQaW5BcHBOb25Db25zdW1hYmxlUHVyY2hhc2VDb3Vu
dAAAAAAACGlzRnJlc2hJbnN0YWxsAAEIaGFzVXNlclJ1bkFwcEJlZm9yZQABCWxhc3REYWlseU9u
bGluZUxvZwCA83fufMf//wlsYXN0UGxheURhdGUAgPN37nzH//8JbGFzdFF1aXREYXRlAIDzd+58
x///Amxhc3RQdXJjaGFzZWRCdW5kbGUABQAAAE5vbmUACGhhc1BhaWRPdXRGYWNlYm9va1Jld2Fy
ZAAACGhhc1NlZW5Gcm9udFNjcmVlbkZpcnN0VGltZQABCGhhc01hZGVPbmVWYWxpZFB1cmNoYXNl
AAACZmlyc3RJbnN0YWxsZWRWZXJzaW9uAAEAAAAACWZpcnN0SW5zdGFsbERhdGUANtpMF5IBAAAI
aGFzRG91YmxlQ29pbnNVcGdyYWRlAAAIaGFzQWRSZW1vdmFsVXBncmFkZQAAA2hhc0NoYXJhY3Rl
ckJlZW5TZWVuAAUAAAAAA2hhc0JvYXJkQmVlblNlZW4ABQAAAAADY2hhcmFjdGVyT3V0Zml0c1Nl
ZW4AUwEAAARuaW5qYQAMAAAAEDAAAAAAAAAEcHJpbmNlawATAAAAEDAAAAAAABAxAAIAAAAABGZy
YW5rAAwAAAAQMAAAAAAAAARraW5nAAwAAAAQMAAAAAAAAARmcml6enkADAAAABAwAAAAAAAABHNs
aWNrABMAAAAQMAABAAAAEDEAAAAAAAAEem9lABMAAAAQMAAAAAAAEDEAAgAAAAAEYnJvZHkAEwAA
ABAwAAAAAAAQMQABAAAAAAR0YWcAEwAAABAwAAAAAAAQMQABAAAAAAR0YXNoYQAMAAAAEDAAAAAA
AAAEbHVjeQATAAAAEDAAAAAAABAxAAEAAAAABHRyaWNreQAaAAAAEDAAAAAAABAxAAIAAAAQMgAB
AAAAAARmcmVzaAAaAAAAEDAAAAAAABAxAAIAAAAQMgABAAAAAARzcGlrZQAMAAAAEDAAAAAAAAAA
BGNvbGxlY3RDb2luc0R1bW15RGF0YQAjBAAAAzAASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRf
TkFNRV8xAAhoYXNCZWVuQ29sbGVjdGVkAAAQZmFrZVByb2dyZXNzAAAAAAAAAzEASAAAAAJuYW1l
ABQAAABEVU1NWV9GUklFTkRfTkFNRV8yAAhoYXNCZWVuQ29sbGVjdGVkAAAQZmFrZVByb2dyZXNz
AAAAAAAAAzIASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV8zAAhoYXNCZWVuQ29sbGVj
dGVkAAAQZmFrZVByb2dyZXNzAAAAAAAAAzMASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFN
RV8xAAhoYXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzABgAAAAAAzQASAAAAAJuYW1lABQA
AABEVU1NWV9GUklFTkRfTkFNRV81AAhoYXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzABYA
AAAAAzUASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV82AAhoYXNCZWVuQ29sbGVjdGVk
AAEQZmFrZVByb2dyZXNzABMAAAAAAzYASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV83
AAhoYXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzAA8AAAAAAzcASAAAAAJuYW1lABQAAABE
VU1NWV9GUklFTkRfTkFNRV8zAAhoYXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzAA4AAAAA
AzgASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV84AAhoYXNCZWVuQ29sbGVjdGVkAAEQ
ZmFrZVByb2dyZXNzAAoAAAAAAzkASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV8xAAho
YXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzAAcAAAAAAzEwAEgAAAACbmFtZQAUAAAARFVN
TVlfRlJJRU5EX05BTUVfOQAIaGFzQmVlbkNvbGxlY3RlZAABEGZha2VQcm9ncmVzcwACAAAAAAMx
MQBIAAAAAm5hbWUAFAAAAERVTU1ZX0ZSSUVORF9OQU1FXzQACGhhc0JlZW5Db2xsZWN0ZWQAARBm
YWtlUHJvZ3Jlc3MAAgAAAAADMTIASAAAAAJuYW1lABQAAABEVU1NWV9GUklFTkRfTkFNRV8yAAho
YXNCZWVuQ29sbGVjdGVkAAEQZmFrZVByb2dyZXNzAAEAAAAAAzEzAEgAAAACbmFtZQAUAAAARFVN
TVlfRlJJRU5EX05BTUVfMwAIaGFzQmVlbkNvbGxlY3RlZAABEGZha2VQcm9ncmVzcwAAAAAAAAAD
ZWFybkN1cnJlbmN5RGF0YQAFAAAAAANpbkFwcFB1cmNoYXNlSGlzdG9yeQAFAAAAABBudW1iZXJP
ZkJyZWFkQ3J1bWJzU2hvd25PbkZyb250UGFnZQDDBQAAEGFnZVJlc3RyaWN0aW9uSW5wdXRWZXJz
aW9uAAAAAAAQYWdlUmVzdHJpY3Rpb25JbnB1dE1vbnRoAAwAAAAQYWdlUmVzdHJpY3Rpb25JbnB1
dFllYXIAzwcAAANicmVhZGNydW1icwBaAAAAAmxhc3REYWlseVdvcmQABQAAAERBU0gAEndlZWts
eUh1bnRQZXJpb2RFeHBpcmVEYXRlVGlja3MAAAAAAAAAAAAQbGFzdE1pc3Npb25TZXQAAgAAAAAC
bGFzdEV2ZW50VHlwZVNob3duAAUAAABOb25lAAlsYXN0RXZlbnRTaG93blRpbWVzdGFtcACA83fu
fMf//wJsYXN0U2VlbkJ1bmRsZVZlcnNpb24ABAAAADEuMAAJbGFzdFRpbWVBVmlkZW9Gb3JLZXlz
V2FzU2VlbgCA83fufMf//wl3ZWxjb21lUGFja1N0YXJ0VGltZQCA83fufMf//xBjdXJyZW50SW50
cm9WaWRlb0FkUHJpemVJbmRleAAAAAAAEGN1cnJlbnRSYW5kb21WaWRlb0FkUHJpemVJbmRleAAA
AAAAEGN1cnJlbnRWaWRlb0FkUHJpemVTZWVkAHCrmkcQdmlkZW9zV2F0Y2hlZFNpbmNlRGFpbHlL
ZXlzAAAAAAADZnJpZW5kU3RhdHVzAAUAAAAACGFsbG93U2VsbEhlYWRzdGFydER1cmluZ1J1bgAB
CGFsbG93U2VsbFNjb3JlYm9vc3RlckR1cmluZ1J1bgABCGhhc0NvbGxlY3RlZEZyb21GcmllbmRz
AAAIaGFzU2hvd25Db2xsZWN0UG9wdXAAAAhoYXNTaG93bkZhY2Vib29rUG9wdXAAAAhoYXNTaG93
bkhvdmVyYm9hcmRQb3B1cAAACGhhc1Nob3duTWlzc2lvbkludHJvUG9wdXAAAAhoYXNTaG93bkVu
ZEdhbWVNaXNzaW9uUG9wdXAAAAhpc1R1dG9yaWFsQ29tcGxldGVkAAEIc2hvdWxkU2hvd0NvbGxl
Y3RQb3B1cAAACHNob3VsZFNob3dGYWNlYm9va1BvcHVwAAAIc2hvdWxkU2hvd0hvdmVyYm9hcmRQ
b3B1cAABCHNob3VsZFNob3dNaXNzaW9uSW50cm9kdWN0aW9uUG9wdXAAAAhzaG91bGRTaG93RW5k
R2FtZU1pc3Npb25Qb3B1cAAAEGxhc3RTaG93blRvcFJ1bkludHJvUG9wdXBWZXJzaW9uTnVtYmVy
AAAAAAAIbmV2ZXJBc2tGb3JSYXRpbmcAAAJsYW5ndWFnZQABAAAAAAhzb3VuZEVmZmVjdHNFbmFi
bGVkAAEIbXVzaWNFbmFibGVkAAAIdG9wUnVuQ2hhbGxlbmdlcnNFbmFibGVkAAEIcmVtb3RlTm90
aWZpY2F0aW9uc0VuYWJsZWQAARBsb2NhbE5vdGlmaWNhdGlvbnNFbmFibGVkAP////8IaGFzTG9n
Z2VkU3RhdGljRGF0YQAACWxhc3RMb2dnZWREYWlseURhdGEAgPN37nzH//8BYW5hbHl0aWNzU2Ft
cGxpbmdLZXkAAAAAIK+24D8JYWJUZXN0TGFzdERhaWx5RXZlbnRzUmVwb3J0RGF0ZQCA83fufMf/
/wJhYlRlc3RQbGF5ZXJTZWVkAAsAAAAyMjM1Njc1ODkzAAJhYlRlc3RUYWdEYXRhAAEAAAAAAmZs
dXJyeVVzZXJJZAABAAAAAAhoYXNMb2dnZWRHYW1lQ2VudGVyTG9naW4AAAhoYXNMb2dnZWRGYWNl
Ym9va0xvZ2luAAADaGFzTG9nZ2VkRmx1cnJ5RGFpbHlFdmVudFNvY2lhbAAFAAAAAAA=
`.replace(/\s+/g, "");

  const FALLBACK_SAVE_PAYLOAD = {
    timestamp: 1732485593978,
    mode: 33206,
    contents_b64: FALLBACK_CONTENTS_B64
  };

  function normalizeBase64(b64) {
    return (b64 || "").replace(/\s+/g, "");
  }

  function b64ToU8(b64) {
    const bin = atob(b64);
    const arr = new Uint8Array(bin.length);
    for (let i = 0; i < bin.length; i++) {
      arr[i] = bin.charCodeAt(i);
    }
    return arr;
  }

  function openDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME);
      request.onupgradeneeded = function (event) {
        const db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME);
        }
      };
      request.onsuccess = function (event) {
        resolve(event.target.result);
      };
      request.onerror = function () {
        reject(request.error || new Error("Erro ao abrir o IndexedDB."));
      };
    });
  }

  function getObjectStore(db, mode) {
    return db.transaction([STORE_NAME], mode).objectStore(STORE_NAME);
  }

  function readCurrentSave(db) {
    return new Promise((resolve, reject) => {
      try {
        const store = getObjectStore(db, "readonly");
        const request = store.get(KEY_PATH);
        request.onsuccess = function () {
          resolve(request.result || null);
        };
        request.onerror = function () {
          reject(request.error || new Error("Erro ao ler dados da IndexedDB."));
        };
      } catch (err) {
        reject(err);
      }
    });
  }

  function writeSave(db, value) {
    return new Promise((resolve, reject) => {
      try {
        const store = getObjectStore(db, "readwrite");
        const request = store.put(value, KEY_PATH);
        request.onsuccess = function () {
          resolve(true);
        };
        request.onerror = function () {
          reject(request.error || new Error("Erro ao gravar dados na IndexedDB."));
        };
      } catch (err) {
        reject(err);
      }
    });
  }

  function arraysEqual(a, b) {
    if (!a || !b || a.length !== b.length) return false;
    for (let i = 0; i < a.length; i++) {
      if (a[i] !== b[i]) return false;
    }
    return true;
  }

  async function loadSavePayload() {
    if (typeof fetch !== "function") {
      return { ...FALLBACK_SAVE_PAYLOAD };
    }
    try {
      const response = await fetch("../saves/default.json", { cache: "no-store" });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      const json = await response.json();
      if (!json || typeof json !== "object" || !json.payload) {
        throw new Error("Resposta inválida ao carregar default.json");
      }
      const payload = { ...json.payload };
      if (payload.contents_b64 || payload.contentsB64) {
        payload.contents_b64 = normalizeBase64(payload.contents_b64 || payload.contentsB64);
      } else {
        throw new Error("Conteúdo do save ausente em default.json");
      }
      return payload;
    } catch (err) {
      console.warn("Não foi possível carregar default.json; usando save incorporado.", err);
      return { ...FALLBACK_SAVE_PAYLOAD };
    }
  }

  async function applySave(payload) {
    const timestampValue = Number(payload.timestamp);
    const timestampMs = Number.isFinite(timestampValue)
      ? timestampValue
      : Date.parse(payload.timestamp);
    const record = {
      timestamp: Number.isFinite(timestampMs) ? new Date(timestampMs) : new Date(),
      mode: Number(payload.mode) || 0,
      contents: b64ToU8(normalizeBase64(payload.contents_b64 || payload.contentsB64))
    };

    const db = await openDatabase();
    try {
      const existing = await readCurrentSave(db);
      if (existing) {
        const existingTimestamp = existing.timestamp instanceof Date
          ? existing.timestamp.getTime()
          : Number(existing.timestamp);
        const sameTimestamp = Number.isFinite(existingTimestamp)
          && existingTimestamp === record.timestamp.getTime();
        const sameMode = existing.mode === record.mode;
        let sameContents = false;
        if (existing.contents) {
          const existingContents = existing.contents instanceof Uint8Array
            ? existing.contents
            : new Uint8Array(existing.contents);
          sameContents = arraysEqual(existingContents, record.contents);
        }
        if (sameTimestamp && sameMode && sameContents) {
          console.info("Save atual já corresponde ao backup. Nenhuma alteração necessária.");
          return;
        }
      }

      await writeSave(db, record);
      console.log("Save aplicado com sucesso!");
    } finally {
      db.close();
    }
  }

  (async function run() {
    try {
      const payload = await loadSavePayload();
      await applySave(payload);
    } catch (err) {
      console.error("Erro ao aplicar save:", err);
    }
  })();
})();

